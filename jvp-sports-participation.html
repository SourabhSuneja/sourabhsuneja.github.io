<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sports Meet 2025-26 | Jamna Vidyapeeth</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary: #1a237e;
            --secondary: #283593;
            --text-dark: #333;
            --text-light: #666;
            --bg-light: #f4f6f9;
            --white: #ffffff;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            
            /* House Colors - Default */
            --house-color: #6c757d; 
            --house-bg: #e9ecef;
        }

        /* House Specific Overrides */
        body.house-Emerald { --house-color: #27ae60; --house-bg: #e8f8f0; }
        body.house-Ruby { --house-color: #c0392b; --house-bg: #f9ebeb; }
        body.house-Sapphire { --house-color: #2980b9; --house-bg: #eaf4fb; }
        body.house-Topaz { --house-color: #f39c12; --house-bg: #fef9e7; }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        
        body { background-color: var(--bg-light); color: var(--text-dark); padding-bottom: 40px; }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--white);
            padding: 2rem 1rem;
            text-align: center;
            border-bottom-left-radius: 30px;
            border-bottom-right-radius: 30px;
            box-shadow: var(--shadow);
            position: relative;
        }

        .school-name { font-size: 0.9rem; letter-spacing: 1px; opacity: 0.9; text-transform: uppercase; }
        .event-title { font-size: 1.8rem; font-weight: 700; margin-top: 5px; }
        .year-tag { background: rgba(255,255,255,0.2); padding: 2px 10px; border-radius: 15px; font-size: 0.8rem; }

        /* Container */
        .container { max-width: 800px; margin: -40px auto 0; padding: 0 1.5rem; position: relative; z-index: 10; }

        /* Student Profile Card */
        .profile-card {
            background: var(--white);
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            box-shadow: var(--shadow);
            border-top: 5px solid var(--house-color);
            margin-bottom: 2rem;
        }

        .avatar-placeholder {
            width: 80px; height: 80px;
            background: var(--house-bg);
            color: var(--house-color);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 2rem; margin: 0 auto 1rem;
            border: 2px solid var(--house-color);
        }

        .student-name { font-size: 1.5rem; font-weight: 600; margin-bottom: 0.5rem; }
        
        .student-details {
            display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;
            margin-top: 10px;
        }

        .badge {
            padding: 5px 15px; border-radius: 20px; font-size: 0.85rem; font-weight: 500;
            display: flex; align-items: center; gap: 5px;
        }

        .badge-house { background-color: var(--house-bg); color: var(--house-color); }
        .badge-class { background-color: #f0f0f0; color: #555; }

        /* Section Titles */
        .section-title {
            font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; color: var(--text-light);
            display: flex; align-items: center; gap: 10px;
        }
        .section-title i { color: var(--house-color); }

        /* Event Cards */
        .events-grid { display: grid; gap: 1.5rem; }
        
        .event-card {
            background: var(--white); border-radius: 15px; overflow: hidden;
            box-shadow: var(--shadow); transition: transform 0.2s;
            border-left: 4px solid transparent;
        }
        
        .event-card.type-Individual { border-left-color: #9b59b6; }
        .event-card.type-Grouped { border-left-color: #e67e22; }
        .event-card.type-Team { border-left-color: #3498db; }

        .event-header {
            padding: 1rem 1.5rem; border-bottom: 1px solid #eee;
            display: flex; justify-content: space-between; align-items: center;
        }
        
        .event-name { font-weight: 600; font-size: 1.1rem; color: var(--primary); }
        .event-type-badge { font-size: 0.75rem; padding: 2px 8px; border-radius: 4px; background: #eee; color: #666; }

        .event-body { padding: 1.5rem; }
        
        .info-row { display: flex; gap: 20px; margin-bottom: 10px; font-size: 0.9rem; color: var(--text-light); }
        .info-item i { width: 20px; text-align: center; margin-right: 5px; color: var(--secondary); }

        .teammates-section {
            margin-top: 1rem; background: #f8f9fa; padding: 1rem; border-radius: 10px;
        }
        .teammates-label { font-size: 0.8rem; font-weight: 600; margin-bottom: 5px; color: #888; text-transform: uppercase; }
        .teammates-list { display: flex; flex-wrap: wrap; gap: 8px; }
        .mate-chip {
            background: var(--white); border: 1px solid #e0e0e0;
            padding: 4px 10px; border-radius: 15px; font-size: 0.8rem;
        }

        /* Rules & Footer */
        .rules-box {
            background: #fff3cd; border: 1px solid #ffeeba; color: #856404;
            padding: 1.5rem; border-radius: 15px; margin-top: 2rem;
        }
        .rules-title { font-weight: 600; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 8px; }

        .qr-reminder {
            text-align: center; margin-top: 2rem; padding: 2rem;
            background: var(--white); border-radius: 20px; box-shadow: var(--shadow);
        }
        .qr-icon { font-size: 3rem; color: var(--primary); margin-bottom: 1rem; }

        /* Loading/Error States */
        #loading, #error-msg { text-align: center; padding: 4rem 1rem; }
        #app-content { display: none; }

        /* Mobile Optimization */
        @media (max-width: 600px) {
            .event-header { flex-direction: column; align-items: flex-start; gap: 5px; }
            .info-row { flex-direction: column; gap: 5px; }
        }
    </style>
</head>
<body>

    <div id="loading">
        <i class="fas fa-spinner fa-spin fa-2x" style="color: var(--primary);"></i>
        <p style="margin-top: 1rem;">Verifying Identity...</p>
    </div>

    <div id="error-msg" style="display: none;">
        <i class="fas fa-exclamation-circle fa-3x" style="color: #c0392b;"></i>
        <h2 style="margin: 1rem 0;">Access Denied</h2>
        <p>We could not find student records associated with this QR code.</p>
    </div>

    <div id="app-content">
        <header>
            <div class="school-name">Jamna Vidyapeeth</div>
            <div class="event-title">Annual Sports Meet</div>
            <span class="year-tag">2025-26</span>
        </header>

        <div class="container">
            <div class="profile-card">
                <div class="avatar-placeholder">
                    <i class="fas fa-user"></i>
                </div>
                <h1 class="student-name" id="display-name">--</h1>
                <div class="student-details">
                    <div class="badge badge-class">
                        <i class="fas fa-graduation-cap"></i> <span id="display-class">--</span>
                    </div>
                    <div class="badge badge-house">
                        <i class="fas fa-shield-alt"></i> House <span id="display-house">--</span>
                    </div>
                </div>
            </div>

            <div class="section-title">
                <i class="fas fa-running"></i> Your Events
            </div>
            
            <div class="events-grid" id="events-list">
                </div>

            <div class="rules-box">
                <div class="rules-title"><i class="fas fa-balance-scale"></i> Fair Play Policy</div>
                <ul style="padding-left: 20px; font-size: 0.9rem; line-height: 1.6;">
                    <li>Play with integrity. Unfair practices will lead to immediate disqualification of the student or the entire House.</li>
                    <li>Respect the referees and the opposing teams.</li>
                    <li>Report to the ground 15 minutes before your event starts.</li>
                </ul>
            </div>

            <div class="qr-reminder">
                <i class="fas fa-qrcode qr-icon"></i>
                <h3>Entry Pass Required</h3>
                <p style="color: #666; margin-top: 0.5rem; font-size: 0.9rem;">
                    Please keep this digital pass or QR code handy. <br>
                    <strong>No entry allowed without verification at the venue.</strong>
                </p>
            </div>
        </div>
    </div>

    <script>
        // 1. Mock Data Implementation
        const GLOBAL_DATA = [
          { "student_id": "b34ee102-0643-496d-bfc2-78f0dee523e6", "student_name": "AADVIK SHARMA", "student_class": "4-A1", "student_house": "Emerald", "student_gender": "M", "event_id": 9, "game_name": "Tug of War (Boys)", "class_category": "3 to 4", "group_size": 20, "gender_filter": "Boys", "game_type": "Team", "participant_group_id": "d09efb57-3720-4d09-9e35-90609500cb59", "access_token": "061d91f0-bbeb-4eb0-b96e-85270cc26911" },
          { "student_id": "0105927c-5d79-47a5-98c8-24d2a3a1c6c5", "student_name": "ARNAV SHARMA", "student_class": "3-A3", "student_house": "Emerald", "student_gender": "M", "event_id": 9, "game_name": "Tug of War (Boys)", "class_category": "3 to 4", "group_size": 20, "gender_filter": "Boys", "game_type": "Team", "participant_group_id": "d09efb57-3720-4d09-9e35-90609500cb59", "access_token": "21064fec-9b49-49d8-8a4a-849fd74a04da" },
          { "student_id": "57fcba30-d93c-40a3-86a6-2d3240bbaa3d", "student_name": "GARV KULDEEP", "student_class": "4-A4", "student_house": "Emerald", "student_gender": "M", "event_id": 9, "game_name": "Tug of War (Boys)", "class_category": "3 to 4", "group_size": 20, "gender_filter": "Boys", "game_type": "Team", "participant_group_id": "d09efb57-3720-4d09-9e35-90609500cb59", "access_token": "4fb1064b-0eee-45f4-97d2-b4168c3036de" },
          { "student_id": "f0156d15-17f6-41b8-8b1e-93a55d89b822", "student_name": "MITANSH", "student_class": "3-A3", "student_house": "Emerald", "student_gender": "M", "event_id": 9, "game_name": "Tug of War (Boys)", "class_category": "3 to 4", "group_size": 20, "gender_filter": "Boys", "game_type": "Team", "participant_group_id": "d09efb57-3720-4d09-9e35-90609500cb59", "access_token": "071f803e-9ddd-46e4-83fa-415c0a8069ec" },
          { "student_id": "a47f2a82-4981-44d7-b09b-3c005b590666", "student_name": "PRATEEK JHAJARIA", "student_class": "3-A3", "student_house": "Emerald", "student_gender": "M", "event_id": 9, "game_name": "Tug of War (Boys)", "class_category": "3 to 4", "group_size": 20, "gender_filter": "Boys", "game_type": "Team", "participant_group_id": "d09efb57-3720-4d09-9e35-90609500cb59", "access_token": "fd01ba61-5563-4080-a40d-a808a21d4ec1" },
          { "student_id": "b90f36ca-10df-4dc7-ab98-0d9246d55c22", "student_name": "SHOURYA KATIYAR", "student_class": "4-A4", "student_house": "Emerald", "student_gender": "M", "event_id": 9, "game_name": "Tug of War (Boys)", "class_category": "3 to 4", "group_size": 20, "gender_filter": "Boys", "game_type": "Team", "participant_group_id": "d09efb57-3720-4d09-9e35-90609500cb59", "access_token": "31f612b9-8b95-4a3f-a94e-3ec72ccc2ebd" },
          { "student_id": "73cf2c86-7032-4ab0-a19b-af3f01434430", "student_name": "VAIBHAV KUMAWAT", "student_class": "3-A1", "student_house": "Emerald", "student_gender": "M", "event_id": 9, "game_name": "Tug of War (Boys)", "class_category": "3 to 4", "group_size": 20, "gender_filter": "Boys", "game_type": "Team", "participant_group_id": "d09efb57-3720-4d09-9e35-90609500cb59", "access_token": "3238fe32-2f92-469f-87a5-5a2d6dffab97" },
          { "student_id": "f45c84c3-3cd5-42c0-bb89-a8a435365bbb", "student_name": "VANSH BARJATI", "student_class": "3-A2", "student_house": "Emerald", "student_gender": "M", "event_id": 9, "game_name": "Tug of War (Boys)", "class_category": "3 to 4", "group_size": 20, "gender_filter": "Boys", "game_type": "Team", "participant_group_id": "d09efb57-3720-4d09-9e35-90609500cb59", "access_token": "041810b5-5272-4d9a-8894-e15633dcad9b" },
          { "student_id": "b04dbd90-c56f-493c-9fb4-a847dd189ddd", "student_name": "VIVAN KUMAWAT", "student_class": "4-A1", "student_house": "Emerald", "student_gender": "M", "event_id": 9, "game_name": "Tug of War (Boys)", "class_category": "3 to 4", "group_size": 20, "gender_filter": "Boys", "game_type": "Team", "participant_group_id": "d09efb57-3720-4d09-9e35-90609500cb59", "access_token": "04b5caab-2629-4214-bc80-8058e49c5728" },
          { "student_id": "b34ee102-0643-496d-bfc2-78f0dee523e6", "student_name": "AADVIK SHARMA", "student_class": "4-A1", "student_house": "Emerald", "student_gender": "M", "event_id": 31, "game_name": "Relay Race (Boys)", "class_category": "4", "group_size": 2, "gender_filter": "Boys", "game_type": "Grouped", "participant_group_id": "d3db1d91-7694-4ab7-8202-b0d668febac7", "access_token": "061d91f0-bbeb-4eb0-b96e-85270cc26911" },
          { "student_id": "25e1b135-078c-4ae2-b7ad-db2f0440725b", "student_name": "DIPESH GEHLOT", "student_class": "4-A2", "student_house": "Emerald", "student_gender": "M", "event_id": 31, "game_name": "Relay Race (Boys)", "class_category": "4", "group_size": 2, "gender_filter": "Boys", "game_type": "Grouped", "participant_group_id": "d3db1d91-7694-4ab7-8202-b0d668febac7", "access_token": "e9d97c90-17e7-45d7-a3bf-94e927f55ce6" },
          { "student_id": "68fe3d6b-e50f-4383-9ae0-ec3048517aa0", "student_name": "TANMAY DANGAYACH", "student_class": "4-A1", "student_house": "Emerald", "student_gender": "M", "event_id": 9, "game_name": "Tug of War (Boys)", "class_category": "3 to 4", "group_size": 20, "gender_filter": "Boys", "game_type": "Team", "participant_group_id": "d09efb57-3720-4d09-9e35-90609500cb59", "access_token": "3077929c-7427-4fe1-a150-2032b9a7c3c6" },
          { "student_id": "3210d4a6-5f8d-4997-acc9-b37243525124", "student_name": "KINSHUK BAGRANIYA", "student_class": "4-A4", "student_house": "Emerald", "student_gender": "M", "event_id": 9, "game_name": "Tug of War (Boys)", "class_category": "3 to 4", "group_size": 20, "gender_filter": "Boys", "game_type": "Team", "participant_group_id": "d09efb57-3720-4d09-9e35-90609500cb59", "access_token": "cfc1cbed-3322-4d00-a3a6-2bae60049e3f" },
          { "student_id": "6593e9a6-16a6-4146-a42c-cfa2fbd841fc", "student_name": "MUDIT", "student_class": "4-A4", "student_house": "Emerald", "student_gender": "M", "event_id": 9, "game_name": "Tug of War (Boys)", "class_category": "3 to 4", "group_size": 20, "gender_filter": "Boys", "game_type": "Team", "participant_group_id": "d09efb57-3720-4d09-9e35-90609500cb59", "access_token": "ae14e160-6afe-4436-8ff2-b7bfd07c6f3a" }
        ];

        // 2. Fetch Logic (Mocked)
        function fetchParticipationData(token) {
            return new Promise((resolve, reject) => {
                // Simulating network delay
                setTimeout(() => {
                    // Filter events specific to the user
                    const studentEvents = GLOBAL_DATA.filter(item => item.access_token === token);
                    
                    if (studentEvents.length > 0) {
                        resolve(studentEvents);
                    } else {
                        reject("Student not found");
                    }
                }, 800);
            });
        }

        // 3. Helper: Find Teammates
        function getTeammates(eventId, groupId, currentStudentId) {
            return GLOBAL_DATA.filter(item => 
                item.event_id === eventId && 
                item.participant_group_id === groupId && 
                item.student_id !== currentStudentId
            );
        }

        // 4. Main App Logic
        async function initApp() {
            const urlParams = new URLSearchParams(window.location.search);
            let token = urlParams.get('token');
            
            // DEMO FALLBACK: If no token provided in URL, use Aadvik Sharma's token for demonstration
            if (!token) {
                console.warn("No token found. Defaulting to demo user.");
                token = "061d91f0-bbeb-4eb0-b96e-85270cc26911"; 
            }

            try {
                const data = await fetchParticipationData(token);
                renderStudentData(data);
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error-msg').style.display = 'block';
            }
        }

        function renderStudentData(events) {
            // Basic Info (taken from first event record)
            const profile = events[0];
            
            document.getElementById('display-name').textContent = profile.student_name;
            document.getElementById('display-class').textContent = profile.student_class;
            document.getElementById('display-house').textContent = profile.student_house;

            // Apply House Theme
            document.body.classList.add(`house-${profile.student_house}`);

            const eventsContainer = document.getElementById('events-list');
            
            // Build Event Cards
            events.forEach(event => {
                const isSolo = event.game_type === 'Individual';
                
                // Find teammates if not solo
                let teammatesHTML = '';
                if (!isSolo) {
                    const teammates = getTeammates(event.event_id, event.participant_group_id, profile.student_id);
                    if (teammates.length > 0) {
                        const teammateChips = teammates.map(tm => `<div class="mate-chip">${tm.student_name} (${tm.student_class})</div>`).join('');
                        const labelText = event.game_type === 'Team' ? 'Team Members' : 'Group Partner(s)';
                        
                        teammatesHTML = `
                            <div class="teammates-section">
                                <div class="teammates-label">${labelText}</div>
                                <div class="teammates-list">
                                    ${teammateChips}
                                </div>
                            </div>
                        `;
                    }
                }

                const cardHTML = `
                    <div class="event-card type-${event.game_type}">
                        <div class="event-header">
                            <div class="event-name">${event.game_name}</div>
                            <div class="event-type-badge">${event.game_type} Event</div>
                        </div>
                        <div class="event-body">
                            <div class="info-row">
                                <div class="info-item"><i class="fas fa-layer-group"></i> Category: Class ${event.class_category}</div>
                                <div class="info-item"><i class="fas fa-venus-mars"></i> Filter: ${event.gender_filter}</div>
                            </div>
                            ${teammatesHTML}
                        </div>
                    </div>
                `;
                eventsContainer.innerHTML += cardHTML;
            });

            // Switch Views
            document.getElementById('loading').style.display = 'none';
            document.getElementById('app-content').style.display = 'block';
        }

        // Run on load
        window.addEventListener('DOMContentLoaded', initApp);

    </script>
</body>
</html>
